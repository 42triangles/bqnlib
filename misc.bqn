âŸ¨TestâŸ© â† â€¢Import "testing.bqn"
âŸ¨PArr,PNum,PChr,PFun,P1Md,P2Md,PNS,PPrimIsh,PNull,PArr1,_pInArr,PStr,PStr1,_pRec
 Ap,Ap2,else,_fâŸ© â‡ â€¢Import "miscbase.bqn"

1 Test PNumâ€¿PStr _pRec 0â€¿"hi"
0 Test PNumâ€¿PStr _pRec 0â€¿âŸ¨'h', 'i', 0âŸ©
0 Test PNumâ€¿PStr _pRec 'h'â€¿"i"

"empty arrays disappear" Test "empty arrays{ğ•©} disappear"_f âŸ¨âŸ©
"strings get inserted as is" Test "{ğ•©} get inserted as is"_f "strings"
"same with chars" Test "same with {ğ•©}hars"_f 'c'
expected â† "everything else gets passed through â€¢Fmt: 2, âŸ¨ 2 2 âŸ©, âŸ¨ 'x' 2 âŸ©, âŸ¨ âŸ¨ ""hi"" âŸ© âŸ©"
fmts     â† "everything else gets passed through â€¢Fmt: {ğ•¨}, {â‹ˆËœğ•¨}, {'x'â‹ˆğ•¨}, {â‹ˆâ‹ˆğ•©}" 
expected Test 2 fmts _f "hi"
"3 + 2 = 5" Test 3 "{ğ•¨} + {ğ•©} = {+}"_f 2

# dynamic repeat
_DR_ â‡ {count â† ğ•¨ğ”¾ğ•© â‹„ next â† (0=count)âŠ‘âŸ¨ğ”½_ğ•£_ğ”¾,âŠ¢âŸ© â‹„ ğ•¨Nextğ•¨ğ”½âŸcountğ•©}
3 Test {+} {1ğ•ğ•©}_DR_(3â‰ âŠ¢) Â¯1  # Works dyadically, works with functions in ğ•¨
3 Test ({ğ•1+âŠ¢}_DR_{3â‰ ğ•0} {1+âŠ¢}){ğ”½}0  # Works monadically, works with functions in ğ•©
3 Test (1+âŠ¢)_DR_(-Â·Ã—3-ËœâŠ¢) 9  # Can do negative steps (if the function on the left is reversible)
3 Test (1+âŠ¢)_DR_(2Ã—2>âŠ¢) 1  # Can use counts other than 1, 0 and Â¯1, it works with any count

# dynamic repeat for fix points
_FP_ â‡ {âŠ‘ğ•¨ğ”½Â¨_DR_(Â·ğ”¾Â´âŠ¢)âŸ¨ğ•¨ğ”½ğ•©,ğ•©âŸ©}
0 Test (2Ã·ËœâŠ¢)_FP_â‰  10  # works monadically
0 Test 2 Ã·Ëœ_FP_â‰  10  # works dyadically

# Atlas
_atl â‡ {ğ•—_ğ•£ r: {ğ•r}Â¨ğ•— ; lğ•—_ğ•£ r: {lğ•r}Â¨ğ•—}
âŸ¨2â€¿1â€¿0â€¿Â¯1,4,1â€¿0â€¿Â¯1â€¿Â¯2,Â¯2âŸ© Test âŸ¨-,â‰ ,âŒ½,+Â´âŸ©_atl Â¯2â€¿Â¯1â€¿0â€¿1

# Defaults
_LD_ â‡ {(ğ•¨âŠ£ğ•—)ğ”¾ğ•©}
_RD_ â‡ {ğ•—_LD_(ğ”¾Ëœ)Ëœ}

RangeE â‡ 0 _LD_(âŠ£+ Â·(Ã—Ã— Â·â†• Ã—Ã—âŠ¢) âŠ¢-âŠ£)
1â€¿2â€¿3 Test 1 RangeE 4
âŸ¨âŸ© Test 1 RangeE 1
1â€¿0 Test 1 RangeE Â¯1
0â€¿Â¯1â€¿Â¯2 Test RangeE Â¯3

RangeI â‡ 0 _LD_(â‹ˆâˆ˜âŠ¢âˆ¾Ëœ âŠ£RangeEâŠ¢)
1â€¿2 Test 1 RangeI 2
âŸ¨1âŸ© Test 1 RangeI 1
1â€¿0 Test 1 RangeI 0
0â€¿1â€¿2â€¿3 Test RangeI 3
